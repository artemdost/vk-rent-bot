#!/usr/bin/env python
"""
Тестовый скрипт для проверки функции анализа договоров.
"""
import asyncio
from bot.services.contract_analyzer import ContractAnalyzer

# Тестовый текст договора
TEST_CONTRACT = """
ДОГОВОР НАЙМА ЖИЛОГО ПОМЕЩЕНИЯ

г. Нижний Новгород                                          "01" января 2024 г.

Гражданин РФ Иванов Иван Иванович, именуемый в дальнейшем "Наймодатель", с одной стороны,
и гражданин РФ Петров Петр Петрович, именуемый в дальнейшем "Наниматель", с другой стороны,
заключили настоящий договор о нижеследующем:

1. ПРЕДМЕТ ДОГОВОРА
1.1. Наймодатель передает Нанимателю за плату во временное пользование квартиру,
расположенную по адресу: г. Нижний Новгород, ул. Ленина, д. 1, кв. 1.

2. СРОК ДОГОВОРА
2.1. Срок найма устанавливается на 11 месяцев с 01.01.2024 по 30.11.2024.

3. АРЕНДНАЯ ПЛАТА
3.1. Размер платы за наем составляет 25000 рублей в месяц.
3.2. Плата вносится ежемесячно не позднее 5 числа текущего месяца.
3.3. При просрочке платежа Наниматель обязан уплатить пеню в размере 5% за каждый день просрочки.

4. ОБЕСПЕЧИТЕЛЬНЫЙ ПЛАТЕЖ
4.1. При заключении договора Наниматель вносит обеспечительный платеж в размере 50000 рублей.
4.2. В случае любого повреждения имущества обеспечительный платеж не возвращается.

5. РАСТОРЖЕНИЕ ДОГОВОРА
5.1. Наймодатель вправе расторгнуть договор в одностороннем порядке без объяснения причин,
предупредив Нанимателя за 3 дня.
5.2. Наниматель не имеет права досрочного расторжения договора.

6. ПРОЧИЕ УСЛОВИЯ
6.1. Коммунальные платежи оплачиваются отдельно.
6.2. Наниматель не имеет права регистрировать в квартире третьих лиц.
"""

async def test_contract_analysis():
    """Тестирует анализ договора."""
    print("=" * 50)
    print("ТЕСТ АНАЛИЗА ДОГОВОРА")
    print("=" * 50)

    analyzer = ContractAnalyzer()

    # Анализируем тестовый договор
    print("\nАнализирую договор...")
    result = await analyzer.analyze_contract(TEST_CONTRACT)

    # Выводим результат в формате VK
    formatted = analyzer.format_analysis_for_vk(result)
    # Используем кодировку utf-8 для правильного вывода эмодзи
    try:
        print("\n" + formatted)
    except UnicodeEncodeError:
        # Если консоль не поддерживает unicode, заменяем эмодзи
        formatted_safe = formatted.encode('ascii', 'replace').decode('ascii')
        print("\n" + formatted_safe)

    # Дополнительная информация
    print("\n" + "=" * 50)
    print("ДЕТАЛЬНАЯ ИНФОРМАЦИЯ")
    print("=" * 50)

    print(f"\nОбщий уровень риска: {result.overall_risk.value}")
    print(f"Количество проблем: {len(result.issues)}")
    print(f"Высокий риск: {sum(1 for i in result.issues if i.risk_level.value == 'high')}")
    print(f"Средний риск: {sum(1 for i in result.issues if i.risk_level.value == 'medium')}")
    print(f"Низкий риск: {sum(1 for i in result.issues if i.risk_level.value == 'low')}")

    if result.key_terms:
        print("\nКлючевые условия:")
        for key, value in result.key_terms.items():
            print(f"  {key}: {value}")

if __name__ == "__main__":
    # Запускаем тест
    asyncio.run(test_contract_analysis())